<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>下剋上数学</title>
  <style>
    body{font-family:"Yu Gothic",sans-serif;background:#f1f3f4;margin:0}
    .container{max-width:720px;margin:40px auto;background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15);overflow:hidden}
    .header{background:#673ab7;color:#fff;padding:20px 24px;font-size:20px}
    .content{padding:24px}
    .question{margin-bottom:28px}
    .qtitle{font-weight:bold;margin-bottom:10px}
    input{width:100%;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:4px}
    .nav{display:flex;justify-content:space-between;margin-top:20px}
    button{padding:10px 18px;border:none;border-radius:4px;background:#673ab7;color:#fff;font-size:14px;cursor:pointer}
    button:disabled{background:#bbb}
    .progress{height:6px;background:#e0e0e0}
    .bar{height:6px;background:#673ab7;width:0%}
    #result{font-size:18px;font-weight:bold;margin-top:20px}
  </style>
</head>
<body>
<div class="container">
  <div class="header">下剋上数学</div>
  <div class="progress"><div class="bar" id="bar"></div></div>
  <div class="content" id="formArea"></div>
</div><script>
// ====== 正解と配点（ここだけ編集してください）======
const answers = {
  "q1_1": { label:"大問1(1)", value:"π/4", points:5 },
  "q1_2": { label:"大問1(2)", value:"12", points:5 },
  "q1_3": { label:"大問1(3)", value:"7/8", points:5 },
  "q1_4": { label:"大問1(4)", value:"1", points:5 },
  "q1_5": { label:"大問1(5)", value:"28,77", points:5 },
  "q2_1": { label:"大問2(1)", value:"21", points:5 },
  "q2_2": { label:"大問2(2)", value:"22", points:10 },
  "q3":   { label:"大問3", value:"5", points:15 },
  "q4":   { label:"大問4", value:"4", points:15 },
  "q5_1": { label:"大問5(1)", value:"700n", points:8 },
  "q5_2": { label:"大問5(2)", value:"700n+65", points:7 },
  "q6":   { label:"大問6", value:"st+uv", points:15 }
};
// ==============================================

const keys = Object.keys(answers);
let index = 0;

function normalize(str){
  return str
    .replace(/[０-９]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0))
    .replace(/\s+/g,"")
    .trim();
}

function canonical(expr){
  expr = normalize(expr);
  if(expr.includes('+')) return expr.split('+').sort().join('+');
  if(expr.includes('*')) return expr.split('*').sort().join('*');
  return expr;
}

function save(value){
  localStorage.setItem(keys[index],value);
}

function load(){
  return localStorage.getItem(keys[index]) || "";
}

function render(){
  const area=document.getElementById("formArea");
  const key=keys[index];
  const q=answers[key];

  const progress=((index)/keys.length)*100;
  document.getElementById("bar").style.width=progress+"%";

  area.innerHTML=`
    <div class="question">
      <div class="qtitle">${q.label}</div>
      <input id="answer" value="${load()}" placeholder="解答を入力">
    </div>
    <div class="nav">
      <button onclick="prev()" ${index===0?"disabled":""}>戻る</button>
      <button onclick="next()">${index===keys.length-1?"送信":"次へ"}</button>
    </div>
  `;
}

function prev(){
  save(document.getElementById("answer").value);
  index--;
  render();
}

function next(){
  save(document.getElementById("answer").value);
  if(index<keys.length-1){
    index++;
    render();
  }else{
    grade();
  }
}

function grade(){
  let score=0,total=0;

  keys.forEach(k=>{
    const user=canonical(localStorage.getItem(k)||"");
    const correct=canonical(answers[k].value);
    const pts=answers[k].points;

    total+=pts;
    if(user===correct) score+=pts;
  });

  document.getElementById("bar").style.width="100%";
  document.getElementById("formArea").innerHTML=`
    <h2>送信完了</h2>
    <div id="result">得点：${score} / ${total}</div>
    <button onclick="location.reload()">もう一度</button>
  `;

  localStorage.clear();
}

render();
</script></body>
</html>
